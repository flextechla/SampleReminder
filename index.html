<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FE2C55">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%23FE2C55'/%3E%3Cg transform='translate(106,80)'%3E%3Crect x='20' y='40' width='260' height='340' rx='20' fill='white' opacity='0.95'/%3E%3Crect x='90' y='20' width='120' height='50' rx='12' fill='white' opacity='0.95'/%3E%3Crect x='100' y='30' width='100' height='30' rx='8' fill='%23FE2C55'/%3E%3Cg transform='translate(50,100)'%3E%3Crect width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 18 L 15 25 L 27 10' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='5' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='20' width='100' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='70' width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 88 L 15 95 L 27 80' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='75' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='90' width='110' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='140' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='145' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='160' width='90' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='210' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='215' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='230' width='120' height='6' rx='3' fill='%23F0F0F0'/%3E%3C/g%3E%3C/g%3E%3Ccircle cx='400' cy='112' r='45' fill='white'/%3E%3Ctext x='400' y='130' text-anchor='middle' font-size='50' font-weight='bold' fill='%23FE2C55' font-family='Arial,sans-serif'%3E3%3C/text%3E%3C/svg%3E">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%23FE2C55'/%3E%3Cg transform='translate(106,80)'%3E%3Crect x='20' y='40' width='260' height='340' rx='20' fill='white' opacity='0.95'/%3E%3Crect x='90' y='20' width='120' height='50' rx='12' fill='white' opacity='0.95'/%3E%3Crect x='100' y='30' width='100' height='30' rx='8' fill='%23FE2C55'/%3E%3Cg transform='translate(50,100)'%3E%3Crect width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 18 L 15 25 L 27 10' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='5' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='20' width='100' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='70' width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 88 L 15 95 L 27 80' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='75' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='90' width='110' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='140' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='145' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='160' width='90' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='210' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='215' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='230' width='120' height='6' rx='3' fill='%23F0F0F0'/%3E%3C/g%3E%3C/g%3E%3Ccircle cx='400' cy='112' r='45' fill='white'/%3E%3Ctext x='400' y='130' text-anchor='middle' font-size='50' font-weight='bold' fill='%23FE2C55' font-family='Arial,sans-serif'%3E3%3C/text%3E%3C/svg%3E">
    <link rel="manifest" id="manifest-placeholder">
    
    <title>Sample Tracker Pro</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root { 
            --primary: #FE2C55; 
            --dark: #121212; 
            --bg: #F8F9FA; 
            --surface: #FFFFFF; 
            --green: #00C853; 
            --yellow: #FFB300; 
            --red: #FF3B30; 
            --blue: #2196F3; 
            --purple: #9C27B0; 
            --border: #E0E0E0; 
            --text-main: #121212;
            --text-secondary: #666666;
            --shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --primary: #FF4066; 
            --dark: #FFFFFF; 
            --bg: #121212; 
            --surface: #1E1E1E; 
            --border: #333333; 
            --text-main: #FFFFFF;
            --text-secondary: #AAAAAA;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); color: var(--text-main); 
            overflow-x: hidden; overscroll-behavior-y: contain;
            transition: background 0.3s, color 0.3s;
        }

        /* --- Landing Page --- */
        #landingPage {
            min-height: 100vh;
            background: linear-gradient(135deg, #FE2C55 0%, #FF6B8A 100%);
            display: flex; /* Visible by default to prevent white flash */
            flex-direction: column;
            padding: 20px 20px 180px 20px; /* High padding for scrolling */
        }
        
        #landingPage.hidden { display: none !important; }
        
        .landing-content { max-width: 500px; width: 100%; text-align: center; color: white; margin: auto; }
        
        .landing-sticky-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--surface); padding: 25px 20px;
            border-radius: 30px 30px 0 0;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.15);
            z-index: 100; display: flex; flex-direction: column; gap: 12px;
        }
        
        .app-icon {
            width: 120px; height: 120px; margin: 0 auto 20px;
            background: white; border-radius: 30px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .landing-title { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .landing-subtitle { font-size: 1.1rem; opacity: 0.95; margin-bottom: 40px; line-height: 1.5; }
        
        .landing-features {
            background: rgba(255,255,255,0.15); backdrop-filter: blur(10px);
            border-radius: 20px; padding: 30px 20px; margin-bottom: 30px; text-align: left;
        }
        
        .feature-item { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; font-size: 1rem; }
        .feature-icon {
            font-size: 1.8rem; width: 50px; height: 50px;
            background: rgba(255,255,255,0.2); border-radius: 12px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        
        .landing-btn { width: 100%; padding: 18px; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: transform 0.2s; }
        .landing-btn:active { transform: scale(0.97); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--bg); color: var(--text-main); border: 1px solid var(--border); }
        
        .landing-links { margin-top: 5px; display: flex; justify-content: center; gap: 20px; font-size: 0.85rem; }
        .landing-link { color: var(--text-secondary); text-decoration: none; opacity: 0.9; border-bottom: 1px solid rgba(0,0,0,0.1); }
        
        /* --- App & UI --- */
        #appContainer { display: none; min-height: 100vh; padding-bottom: 80px; }
        #appContainer.active { display: block; }
        
        .header { background: var(--surface); padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .header h1 { font-size: 1.3rem; font-weight: 800; color: var(--text-main); }
        .header h1 span { color: var(--primary); }
        .icon-btn { background: none; border: none; font-size: 1.3rem; cursor: pointer; padding: 5px; color: var(--text-main); }
        
        .add-sample-btn { 
            background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 25px; 
            font-weight: 700; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 8px; 
            margin-bottom: 10px; width: 100%; justify-content: center; box-shadow: var(--shadow); 
        }
        
        .search-bar { width: 100%; padding: 10px 15px; border: 1.5px solid var(--border); border-radius: 25px; font-size: 0.9rem; background: var(--bg); color: var(--text-main); margin-bottom: 10px; }
        
        .view-toggle { display: flex; gap: 8px; margin-bottom: 12px; }
        .view-btn { flex: 1; padding: 12px 20px; border: 2px solid var(--border); background: var(--surface); border-radius: 25px; font-size: 0.9rem; font-weight: 700; cursor: pointer; color: var(--text-secondary); }
        .view-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .container { max-width: 600px; margin: 0 auto; padding: 12px; }
        
        .control-section { background: var(--surface); border-radius: 12px; padding: 15px; margin-bottom: 12px; margin-top: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .section-title { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 10px; letter-spacing: 0.5px; }
        .filter-btn { padding: 10px 18px; border: 2px solid var(--border); background: var(--surface); border-radius: 25px; font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); white-space: nowrap; cursor: pointer; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- Cards --- */
        .sample-card { background: var(--surface); border-radius: 16px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); position: relative; }
        .sample-card.selecting { border: 2px solid var(--primary); }
        .card-body { padding: 16px; }
        .brand-name { font-size: 0.75rem; color: var(--text-secondary); font-weight: 700; text-transform: uppercase; }
        .product-name { font-size: 1.1rem; font-weight: 700; color: var(--text-main); margin: 4px 0 8px 0; }
        
        .days-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 800; margin-bottom: 10px; }
        .days-badge.overdue { background: #FFEBEE; color: var(--red); }
        .days-badge.urgent { background: #FFF8E1; color: var(--yellow); }
        .days-badge.good { background: #E8F5E9; color: var(--green); }
        .days-badge.completed { background: #E0E0E0; color: #666; }
        
        /* Dark mode badges */
        [data-theme="dark"] .days-badge.overdue { background: rgba(255, 59, 48, 0.2); color: #FF6B6B; }
        [data-theme="dark"] .days-badge.urgent { background: rgba(255, 179, 0, 0.2); color: #FFCA28; }
        [data-theme="dark"] .days-badge.good { background: rgba(0, 200, 83, 0.2); color: #69F0AE; }
        [data-theme="dark"] .days-badge.completed { background: #333; color: #aaa; }

        .tags-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
        .tag { padding: 3px 8px; border-radius: 8px; font-size: 0.7rem; font-weight: 700; background: #E3F2FD; color: #1976D2; }
        [data-theme="dark"] .tag { background: rgba(33, 150, 243, 0.2); color: #64B5F6; }
        
        .photo-row { display: flex; gap: 8px; margin-bottom: 10px; overflow-x: auto; }
        .photo-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; }
        
        .notes-section { background: #FFFDE7; padding: 10px; border-radius: 8px; font-size: 0.85rem; margin-bottom: 10px; border-left: 3px solid var(--yellow); color: #333; }
        [data-theme="dark"] .notes-section { background: rgba(255, 255, 255, 0.05); color: #ddd; border-left-color: var(--yellow); }
        
        .checklist { background: var(--bg); padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        .checklist-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 0.85rem; color: var(--text-main); }
        
        .progress-container { width: 100%; height: 8px; background: var(--border); border-radius: 4px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.4s ease; }
        
        .meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: var(--bg); padding: 12px; border-radius: 10px; font-size: 0.85rem; margin-bottom: 10px; }
        .meta-label { color: var(--text-secondary); font-size: 0.7rem; display: block; margin-bottom: 2px; font-weight: 600; }
        .meta-value { font-weight: 700; color: var(--text-main); }
        
        .action-container { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
        .row-btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; font-size: 0.95rem; cursor: pointer; display: flex; align-items: center; justify-content: center; text-decoration: none; transition: transform 0.2s; }
        .row-btn:active { transform: scale(0.95); }
        
        .btn-full-width { background: var(--primary); color: white; }
        .btn-completed { background: #E8F5E9; color: var(--green); border: 1.5px solid var(--green); pointer-events: none; }
        [data-theme="dark"] .btn-completed { background: rgba(0, 200, 83, 0.2); }
        
        .btn-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-secondary { background: var(--surface); color: var(--text-main); border: 1.5px solid var(--border); }
        
        /* Compact Mode Overrides */
        body.compact-mode .sample-card { padding: 10px; margin-bottom: 12px; }
        body.compact-mode .photo-row, body.compact-mode .notes-section { display: none; }
        body.compact-mode .days-badge { margin-bottom: 5px; font-size: 0.65rem; padding: 2px 8px; }
        body.compact-mode .product-name { font-size: 1rem; margin: 2px 0 4px 0; }
        body.compact-mode .checklist-item { font-size: 0.75rem; margin-bottom: 2px; }
        body.compact-mode .row-btn { padding: 10px; font-size: 0.85rem; }
        body.compact-mode .action-container { gap: 6px; margin-top: 6px; }

        /* Batch Bar */
        .batch-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); color: var(--text-main); padding: 15px; display: none; justify-content: space-between; align-items: center; z-index: 99; box-shadow: 0 -4px 12px rgba(0,0,0,0.2); border-top: 1px solid var(--border); }
        .batch-bar.active { display: flex; }
        .batch-btn { padding: 8px 16px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-size: 0.85rem; }

        /* Modals */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 1000; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .modal.active { display: flex; }
        .modal-content { background: var(--surface); width: 100%; max-width: 500px; border-radius: 24px; padding: 24px; max-height: 90vh; overflow-y: auto; margin: auto; color: var(--text-main); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-weight: 800; font-size: 1.3rem; }
        .modal-close { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: var(--text-secondary); }
        
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-weight: 700; font-size: 0.85rem; margin-bottom: 6px; color: var(--text-main); }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 12px; border: 1.5px solid var(--border); border-radius: 12px; font-size: 1rem; background: var(--bg); font-family: inherit; color: var(--text-main); }
        
        .tags-input-container { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px; border: 1.5px solid var(--border); border-radius: 12px; background: var(--bg); min-height: 45px; }
        .tag-input-field { border: none; background: none; outline: none; flex: 1; min-width: 100px; font-size: 0.9rem; color: var(--text-main); }
        
        .photo-upload-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .photo-upload-item { position: relative; aspect-ratio: 1; border: 2px dashed var(--border); border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; }
        .photo-upload-item img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Calendar */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
        .calendar-header { text-align: center; font-weight: 700; font-size: 0.7rem; color: var(--text-secondary); padding: 8px 0; }
        .calendar-day { aspect-ratio: 1; border: 1px solid var(--border); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.75rem; cursor: pointer; background: var(--surface); position: relative; color: var(--text-main); }
        .calendar-day.has-items { background: #FFF3E0; border-color: var(--yellow); }
        [data-theme="dark"] .calendar-day.has-items { background: rgba(255, 179, 0, 0.1); }
        
        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--green); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Browser Overlay */
        .browser-overlay { display: none; position: fixed; inset: 0; background: white; z-index: 2000; flex-direction: column; }
        .browser-overlay.active { display: flex; }
        .browser-header { background: var(--primary); color: white; padding: 15px; display: flex; align-items: center; justify-content: space-between; }
        .browser-frame { flex: 1; border: none; width: 100%; }

        .analytics-section { background: var(--surface); border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: var(--shadow); }
        .analytics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .analytics-card { text-align: center; padding: 15px; background: var(--bg); border-radius: 12px; }
        .analytics-number { font-size: 1.8rem; font-weight: 800; color: var(--primary); }
    </style>
</head>
<body>
    <div id="landingPage">
        <div class="landing-content">
            <div class="app-icon">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="15" y="5" width="70" height="10" rx="3" fill="#FE2C55"/>
                    <rect x="20" y="25" width="10" height="10" rx="2" fill="#00C853"/>
                    <rect x="20" y="42" width="10" height="10" rx="2" fill="#00C853"/>
                </svg>
            </div>
            
            <h1 class="landing-title">Sample Tracker Pro</h1>
            <p class="landing-subtitle">Never miss a deadline. Track collaborations, get reminders, and stay organized.</p>
            
            <div class="landing-features">
                <div class="feature-item"><div class="feature-icon">üì¶</div>Track all samples</div>
                <div class="feature-item"><div class="feature-icon">‚è∞</div>Deadlines & reminders</div>
                <div class="feature-item"><div class="feature-icon">‚òÅÔ∏è</div>Cloud sync</div>
                <div class="feature-item"><div class="feature-icon">üìä</div>Analytics</div>
            </div>
        </div>

        <div class="landing-sticky-bar">
            <button class="landing-btn btn-primary" onclick="showAuth('signup')">Create Free Account</button>
            <button class="landing-btn btn-secondary" onclick="showAuth('signin')">Sign In</button>
            <div class="landing-links">
                <a href="#" class="landing-link" onclick="openPrivacy(); return false;">Privacy Policy</a>
                <a href="#" class="landing-link" onclick="openHelp(); return false;">Help</a>
            </div>
        </div>
    </div>

    <div id="appContainer">
        <div class="header">
            <div class="header-top">
                <h1><span>Sample</span> Tracker</h1>
                <div class="header-actions">
                    <button class="icon-btn" onclick="openAnalytics()">üìä</button>
                    <button class="icon-btn" onclick="toggleMenu()">‚ãÆ</button>
                </div>
            </div>
            <button class="add-sample-btn" onclick="openModal()">+ Add New Sample</button>
            <div class="view-toggle">
                <button class="view-btn active" id="view-list" onclick="setView('list')">üìã List View</button>
                <button class="view-btn" id="view-calendar" onclick="setView('calendar')">üìÖ Calendar View</button>
            </div>
            <input type="text" class="search-bar" id="searchBar" placeholder="Search brands..." oninput="handleSearch()">
        </div>
        
        <div class="container">
            <div id="listView">
                <div class="control-section">
                    <div class="section-title">Filter</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                        <button class="filter-btn active" id="f-all" onclick="setFilter('all')">All</button>
                        <button class="filter-btn" id="f-overdue" onclick="setFilter('overdue')">üî• Overdue</button>
                        <button class="filter-btn" id="f-urgent" onclick="setFilter('urgent')">‚ö†Ô∏è Due Soon</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="filter-btn" id="f-good" onclick="setFilter('good')">‚úÖ On Track</button>
                        <button class="filter-btn" id="f-completed" onclick="setFilter('completed')">üèÅ Posted</button>
                    </div>
                </div>
                <div id="sampleGrid"></div>
            </div>

            <div id="calendarView" style="display:none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <button class="icon-btn" onclick="changeMonth(-1)">‚óÄ</button>
                    <h2 id="calendarMonth" style="font-weight: 800;"></h2>
                    <button class="icon-btn" onclick="changeMonth(1)">‚ñ∂</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div id="calendarDayDetails" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <div class="batch-bar" id="batchBar">
        <div><strong><span id="selectedCount">0</span> selected</strong></div>
        <button class="batch-btn" style="background: var(--red); color: white;" onclick="batchDelete()">üóë Delete Selected</button>
        <button class="batch-btn" style="background: white; color: var(--dark);" onclick="clearSelection()">Cancel</button>
    </div>

    <div id="menuModal" class="modal">
        <div class="modal-content" style="max-width: 300px;">
            <div class="modal-header"><h2 class="modal-title">Menu</h2><button class="modal-close" onclick="closeMenu()">√ó</button></div>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="row-btn btn-secondary" onclick="goToLanding(); closeMenu()">üè† Home</button>
                <button class="row-btn btn-secondary" onclick="openSettings(); closeMenu()">‚öôÔ∏è Settings</button>
                <button class="row-btn btn-secondary" onclick="openInstall(); closeMenu()">üì≤ Install App</button>
                <button class="row-btn btn-secondary" onclick="openSupport(); closeMenu()">üí¨ Contact Support</button>
                <button class="row-btn btn-secondary" onclick="openHelp(); closeMenu()">‚ùì Help</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">‚öôÔ∏è Settings</h2><button class="modal-close" onclick="closeSettings()">√ó</button></div>
            
            <div class="form-group">
                <label class="form-label">Account</label>
                <div id="cloudStatus" style="padding: 15px; background: var(--bg); border-radius: 12px; margin-bottom: 10px;">
                    <p style="margin-bottom: 5px; font-weight: 700;">üíæ Status</p>
                    <p style="font-size: 0.85rem;" id="statusText">Checking...</p>
                </div>
            </div>
            
            <div class="form-group">
                <div style="padding: 15px; background: var(--bg); border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom:10px;">
                    <span style="font-weight: 600;">üåô Dark Mode</span>
                    <label class="switch"><input type="checkbox" id="darkModeToggle" onchange="toggleTheme(this.checked)"><span class="slider"></span></label>
                </div>
                <div style="padding: 15px; background: var(--bg); border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom:10px;">
                    <span style="font-weight: 600;">üì≥ Haptic Feedback</span>
                    <label class="switch"><input type="checkbox" id="hapticToggle" onchange="toggleHaptic(this.checked)"><span class="slider"></span></label>
                </div>
                <div style="padding: 15px; background: var(--bg); border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 600;">üì± Compact Mode</span>
                    <label class="switch"><input type="checkbox" id="compactToggle" onchange="toggleCompact(this.checked)"><span class="slider"></span></label>
                </div>
            </div>

            <div class="form-group" style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">
                <label class="form-label" style="color: var(--red);">Danger Zone</label>
                <button class="row-btn btn-secondary" onclick="openResetModal()" style="color: var(--red); border-color: var(--red); margin-bottom:10px;">‚ö†Ô∏è Reset App</button>
                <button class="row-btn btn-secondary" onclick="openDeleteAccount()" style="color: var(--red); border-color: var(--red); background: #FFF0F0;">üóë Delete Account</button>
            </div>
        </div>
    </div>

    <div id="sampleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title" id="modalTitle">Add Sample</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
            <form id="sampleForm" onsubmit="handleSave(event)">
                <div class="form-group"><label class="form-label">Product Name</label><input type="text" id="productName" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Brand</label><input type="text" id="brandName" class="form-input" required></div>
                <div class="form-row">
                    <div><label class="form-label">Received Date</label><input type="date" id="dateReceived" class="form-input" required onchange="calcDuePreview()"></div>
                    <div><label class="form-label">Days to Post</label><input type="number" id="daysLimit" class="form-input" value="14" oninput="calcDuePreview()"></div>
                </div>
                <span id="dueCalcDisplay" class="due-calc-text"></span>
                <div class="form-group"><label class="form-label">Product Link</label><input type="url" id="shopLink" class="form-input" placeholder="Optional"></div>
                <div class="form-group"><label class="form-label">Notes</label><textarea id="notes" class="form-textarea" placeholder="Add notes..."></textarea></div>
                <button type="submit" class="row-btn btn-full-width">Save Sample</button>
            </form>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header"><h2 class="modal-title">Sign In</h2><button class="modal-close" onclick="closeAuthModal()">√ó</button></div>
            <div class="form-group"><label class="form-label">Email</label><input type="email" id="authEmail" class="form-input"></div>
            <div class="form-group"><label class="form-label">Password</label><input type="password" id="authPassword" class="form-input"></div>
            <div id="confirmPassGroup" class="form-group" style="display:none;"><label class="form-label">Confirm Password</label><input type="password" id="authConfirm" class="form-input"></div>
            <div class="form-group" style="display:flex; align-items:center; gap:8px;"><input type="checkbox" id="rememberMe" checked><label style="font-size:0.9rem">Keep me logged in</label></div>
            <div id="authError" style="color:var(--red); font-size:0.9rem; margin-bottom:10px; display:none;"></div>
            <button class="row-btn btn-full-width" onclick="handleAuth()">Submit</button>
            <p style="text-align:center; margin-top:15px; font-size:0.9rem;"><a href="#" onclick="forgotPassword()">Forgot Password?</a></p>
        </div>
    </div>

    <div id="resetModal" class="modal"><div class="modal-content"><h2>‚ö†Ô∏è Reset?</h2><p>This wipes local data.</p><button class="row-btn btn-full-width" style="background:var(--red)" onclick="confirmReset()">Reset</button><button class="row-btn" onclick="closeResetModal()">Cancel</button></div></div>
    <div id="deleteAccModal" class="modal"><div class="modal-content"><h2>üóë Delete Account?</h2><p>This permanently deletes your cloud data and signs you out.</p><button class="row-btn btn-full-width" style="background:var(--red)" onclick="confirmDeleteAccount()">Yes, Delete</button><button class="row-btn" onclick="closeDeleteAccModal()">Cancel</button></div></div>
    <div id="installModal" class="modal"><div class="modal-content"><h2>üì≤ Install</h2><p>iOS: Share > Add to Home Screen<br>Android: Menu > Install</p><button class="row-btn" onclick="document.getElementById('installModal').classList.remove('active')">Close</button></div></div>
    <div id="helpModal" class="modal"><div class="modal-content"><h2>‚ùì Help</h2><p>Check "Posted" to complete a sample.<br>Use top-right checkbox to bulk delete.</p><button class="row-btn" onclick="document.getElementById('helpModal').classList.remove('active')">Close</button></div></div>

    <script>
        const SUPABASE_URL = 'https://eiigbmrjtwndanywrcqp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpaWdibXJqdHduZGFueXdyY3FwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyMDQyMzQsImV4cCI6MjA4Mjc4MDIzNH0.bHCDscs-aeSukDeXAf9kuRC12WBC3zSqIQia-8cIc3s';
        let sb_client = null, currentUser = null, samples = [], selectedSamples = new Set();
        let authMode = 'signin', hapticEnabled = false;

        async function init() {
            sb_client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            // Check persistence preference
            const storage = localStorage.getItem('user_email') ? localStorage : sessionStorage;
            const email = storage.getItem('user_email');
            const pass = storage.getItem('user_password');
            
            if (email && pass) {
                const { data } = await sb_client.auth.signInWithPassword({ email, password: pass });
                if (data.user) { currentUser = data.user; await loadData(); showApp(); return; }
            }
            document.getElementById('landingPage').style.display = 'flex'; // Show landing if no auto-login
        }

        async function loadData() {
            const { data } = await sb_client.from('sample_tracker_data').select('*').eq('user_id', currentUser.id).single();
            if (data) samples = data.samples || [];
            updateStats();
        }

        async function saveData() {
            if (!currentUser) return;
            await sb_client.from('sample_tracker_data').upsert({ user_id: currentUser.id, samples, updated_at: new Date() });
        }

        // --- AUTH ---
        function showAuth(mode) {
            authMode = mode;
            document.getElementById('authModal').classList.add('active');
            document.getElementById('confirmPassGroup').style.display = mode === 'signup' ? 'block' : 'none';
        }
        function closeAuthModal() { document.getElementById('authModal').classList.remove('active'); }

        async function handleAuth() {
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPassword').value;
            const confirm = document.getElementById('authConfirm').value;
            const err = document.getElementById('authError');
            
            if (authMode === 'signup' && pass !== confirm) { err.innerText = "Passwords don't match"; err.style.display='block'; return; }
            
            const { data, error } = authMode === 'signup' 
                ? await sb_client.auth.signUp({ email, password: pass }) 
                : await sb_client.auth.signInWithPassword({ email, password: pass });

            if (error) { err.innerText = error.message; err.style.display='block'; return; }
            
            // Persistence Logic
            const storage = document.getElementById('rememberMe').checked ? localStorage : sessionStorage;
            storage.setItem('user_email', email);
            storage.setItem('user_password', pass);
            
            currentUser = data.user;
            closeAuthModal();
            if(authMode==='signup') setTimeout(openInstall, 2000); // Prompt install on new signup
            await loadData();
            showApp();
        }

        async function forgotPassword() {
            const email = prompt("Enter your email to reset password:");
            if (email) {
                const { error } = await sb_client.auth.resetPasswordForEmail(email);
                alert(error ? error.message : "Password reset link sent!");
            }
        }

        // --- APP LOGIC ---
        async function handleSave(e) {
            e.preventDefault();
            try {
                const brand = document.getElementById('brandName').value;
                const product = document.getElementById('productName').value;
                const date = document.getElementById('dateReceived').value;
                const days = parseInt(document.getElementById('daysLimit').value);
                
                const newItem = {
                    id: Date.now(),
                    brand, product, date, limit: days,
                    checklist: { filmed: false, edited: false, posted: false },
                    done: false
                };
                
                samples.unshift(newItem);
                await saveData();
                render();
            } catch(err) { console.error(err); } 
            finally { closeModal(); }
        }

        function toggleCheckbox(id, field) {
            triggerHaptic();
            const s = samples.find(x => x.id == id);
            s.checklist[field] = !s.checklist[field];
            
            // Logic: Posted = Done
            if (field === 'posted') {
                s.done = s.checklist.posted;
                // Move to posted tab visual feedback?
            }
            saveData();
            render();
        }

        function render() {
            const grid = document.getElementById('sampleGrid');
            grid.innerHTML = samples.filter(s => !s.done).map(s => `
                <div class="sample-card">
                    <input type="checkbox" style="float:right" onchange="toggleSelect(${s.id})">
                    <div class="brand-name">${s.brand}</div>
                    <div class="product-name">${s.product}</div>
                    <div class="checklist">
                        <label class="checklist-item"><input type="checkbox" ${s.checklist.filmed?'checked':''} onchange="toggleCheckbox(${s.id},'filmed')"> Filmed</label>
                        <label class="checklist-item"><input type="checkbox" ${s.checklist.edited?'checked':''} onchange="toggleCheckbox(${s.id},'edited')"> Edited</label>
                        <label class="checklist-item"><input type="checkbox" ${s.checklist.posted?'checked':''} onchange="toggleCheckbox(${s.id},'posted')"> Posted (Done)</label>
                    </div>
                    <button class="row-btn" style="color:red" onclick="deleteSample(${s.id})">Delete</button>
                </div>
            `).join('');
            
            // Logic for "Posted" view would go here if filtering enabled
        }

        function toggleSelect(id) {
            triggerHaptic();
            selectedSamples.has(id) ? selectedSamples.delete(id) : selectedSamples.add(id);
            document.getElementById('batchBar').style.display = selectedSamples.size ? 'flex' : 'none';
            document.getElementById('selectedCount').innerText = selectedSamples.size;
        }

        async function batchDelete() {
            if (confirm("Delete selected items?")) {
                samples = samples.filter(s => !selectedSamples.has(s.id));
                selectedSamples.clear();
                await saveData();
                render();
                document.getElementById('batchBar').style.display = 'none';
            }
        }
        
        async function deleteSample(id) {
            if(confirm("Delete?")) {
                samples = samples.filter(s => s.id != id);
                await saveData();
                render();
            }
        }

        // --- SETTINGS ---
        function toggleTheme(isDark) {
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        
        function toggleCompact(isCompact) {
            isCompact ? document.body.classList.add('compact-mode') : document.body.classList.remove('compact-mode');
            localStorage.setItem('compact', isCompact);
        }
        
        function toggleHaptic(enabled) { hapticEnabled = enabled; localStorage.setItem('haptic', enabled); }
        function triggerHaptic() { if(hapticEnabled && navigator.vibrate) navigator.vibrate(10); }

        function openResetModal() { document.getElementById('resetModal').classList.add('active'); }
        function closeResetModal() { document.getElementById('resetModal').classList.remove('active'); }
        function confirmReset() { localStorage.clear(); location.reload(); }
        
        function openDeleteAccount() { document.getElementById('deleteAccModal').classList.add('active'); }
        function closeDeleteAccModal() { document.getElementById('deleteAccModal').classList.remove('active'); }
        async function confirmDeleteAccount() {
            await sb_client.from('sample_tracker_data').delete().eq('user_id', currentUser.id);
            await sb_client.auth.signOut();
            localStorage.clear();
            location.reload();
        }

        // --- UTILS ---
        function showApp() { 
            document.getElementById('landingPage').style.display = 'none'; 
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('statusText').innerText = `Logged in as ${currentUser.email}`;
            render(); 
        }
        function openModal() { document.getElementById('sampleModal').classList.add('active'); }
        function closeModal() { document.getElementById('sampleModal').classList.remove('active'); }
        function openSettings() { document.getElementById('settingsModal').classList.add('active'); }
        function closeSettings() { document.getElementById('settingsModal').classList.remove('active'); }
        function openInstall() { document.getElementById('installModal').classList.add('active'); }
        function openHelp() { document.getElementById('helpModal').classList.add('active'); }
        function calcDuePreview() { 
            const d = document.getElementById('dateReceived').value;
            if(d) document.getElementById('dueCalcDisplay').innerText = "Due: " + new Date(new Date(d).getTime() + 14*86400000).toLocaleDateString();
        }

        window.onload = init;
    </script>
</body>
</html>
