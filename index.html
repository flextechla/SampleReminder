<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FE2C55">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%23FE2C55'/%3E%3Cg transform='translate(106,80)'%3E%3Crect x='20' y='40' width='260' height='340' rx='20' fill='white' opacity='0.95'/%3E%3Crect x='90' y='20' width='120' height='50' rx='12' fill='white' opacity='0.95'/%3E%3Crect x='100' y='30' width='100' height='30' rx='8' fill='%23FE2C55'/%3E%3Cg transform='translate(50,100)'%3E%3Crect width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 18 L 15 25 L 27 10' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='5' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='20' width='100' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='70' width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 88 L 15 95 L 27 80' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='75' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='90' width='110' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='140' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='145' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='160' width='90' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='210' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='215' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='230' width='120' height='6' rx='3' fill='%23F0F0F0'/%3E%3C/g%3E%3C/g%3E%3Ccircle cx='400' cy='112' r='45' fill='white'/%3E%3Ctext x='400' y='130' text-anchor='middle' font-size='50' font-weight='bold' fill='%23FE2C55' font-family='Arial,sans-serif'%3E3%3C/text%3E%3C/svg%3E">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%23FE2C55'/%3E%3Cg transform='translate(106,80)'%3E%3Crect x='20' y='40' width='260' height='340' rx='20' fill='white' opacity='0.95'/%3E%3Crect x='90' y='20' width='120' height='50' rx='12' fill='white' opacity='0.95'/%3E%3Crect x='100' y='30' width='100' height='30' rx='8' fill='%23FE2C55'/%3E%3Cg transform='translate(50,100)'%3E%3Crect width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 18 L 15 25 L 27 10' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='5' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='20' width='100' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='70' width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 88 L 15 95 L 27 80' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='75' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='90' width='110' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='140' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='145' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='160' width='90' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='210' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='215' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='230' width='120' height='6' rx='3' fill='%23F0F0F0'/%3E%3C/g%3E%3C/g%3E%3Ccircle cx='400' cy='112' r='45' fill='white'/%3E%3Ctext x='400' y='130' text-anchor='middle' font-size='50' font-weight='bold' fill='%23FE2C55' font-family='Arial,sans-serif'%3E3%3C/text%3E%3C/svg%3E">
    <link rel="manifest" id="manifest-placeholder">
    
    <title>Sample Tracker Pro</title>
    
    <script>
        const manifestData = {
            "name": "Sample Tracker Pro",
            "short_name": "Samples",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#FFFFFF",
            "theme_color": "#FE2C55",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%23FE2C55'/%3E%3Cg transform='translate(106,80)'%3E%3Crect x='20' y='40' width='260' height='340' rx='20' fill='white' opacity='0.95'/%3E%3Crect x='90' y='20' width='120' height='50' rx='12' fill='white' opacity='0.95'/%3E%3Crect x='100' y='30' width='100' height='30' rx='8' fill='%23FE2C55'/%3E%3Cg transform='translate(50,100)'%3E%3Crect width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 18 L 15 25 L 27 10' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='5' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='20' width='100' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='70' width='35' height='35' rx='7' fill='%2300C853' stroke='white' stroke-width='2'/%3E%3Cpath d='M 8 88 L 15 95 L 27 80' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='50' y='75' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='90' width='110' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='140' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='145' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='160' width='90' height='6' rx='3' fill='%23F0F0F0'/%3E%3Crect y='210' width='35' height='35' rx='7' fill='white' stroke='%23E0E0E0' stroke-width='3'/%3E%3Crect x='50' y='215' width='140' height='8' rx='4' fill='%23E0E0E0'/%3E%3Crect x='50' y='230' width='120' height='6' rx='3' fill='%23F0F0F0'/%3E%3C/g%3E%3C/g%3E%3Ccircle cx='400' cy='112' r='45' fill='white'/%3E%3Ctext x='400' y='130' text-anchor='middle' font-size='50' font-weight='bold' fill='%23FE2C55' font-family='Arial,sans-serif'%3E3%3C/text%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml"
                }
            ]
        };
        const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root { 
            --primary: #FE2C55; 
            --dark: #121212; 
            --bg: #F8F9FA; 
            --surface: #FFFFFF; 
            --green: #00C853; 
            --yellow: #FFB300; 
            --red: #FF3B30; 
            --blue: #2196F3; 
            --purple: #9C27B0; 
            --border: #E0E0E0; 
            --text-main: #121212;
            --text-secondary: #666666;
            --shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --primary: #FF4066; 
            --dark: #FFFFFF; 
            --bg: #121212; 
            --surface: #1E1E1E; 
            --border: #333333; 
            --text-main: #FFFFFF;
            --text-secondary: #AAAAAA;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            overflow-x: hidden;
            overscroll-behavior-y: contain;
            transition: background 0.3s, color 0.3s;
        }

        /* Compact Mode Overrides */
        body.compact-mode .sample-card { padding: 10px; margin-bottom: 12px; }
        body.compact-mode .photo-row, body.compact-mode .notes-section { display: none; }
        body.compact-mode .days-badge { margin-bottom: 5px; font-size: 0.65rem; padding: 2px 8px; }
        body.compact-mode .product-name { font-size: 1rem; margin: 2px 0 4px 0; }
        body.compact-mode .checklist-item { font-size: 0.75rem; margin-bottom: 2px; }
        body.compact-mode .row-btn { padding: 10px; font-size: 0.85rem; }
        body.compact-mode .action-container { gap: 6px; margin-top: 6px; }
        
        /* Landing Page Styles */
        #landingPage {
            min-height: 100vh;
            background: linear-gradient(135deg, #FE2C55 0%, #FF6B8A 100%);
            display: flex;
            flex-direction: column;
            padding: 20px 20px 140px 20px; 
        }
        
        #landingPage.hidden {
            display: none !important;
        }
        
        .landing-content {
            max-width: 500px;
            width: 100%;
            text-align: center;
            color: white;
            margin: auto;
        }

        /* Sticky Footer Bar */
        .landing-sticky-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 16px 20px;
            display: flex;
            gap: 12px;
        }

        .landing-sticky-bar .primary-button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .landing-sticky-bar .primary-button.signup {
            background: var(--primary);
            color: white;
        }

        .landing-sticky-bar .primary-button.signin {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .landing-sticky-bar .primary-button:active {
            transform: scale(0.98);
        }

        .landing-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            background: white;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .landing-logo svg {
            width: 80px;
            height: 80px;
        }

        .landing-content h1 {
            font-size: 2.5rem;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .landing-content p {
            font-size: 1.1rem;
            opacity: 0.95;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .feature-list {
            text-align: left;
            margin: 40px 0;
            display: grid;
            gap: 20px;
        }

        .feature-item {
            display: flex;
            align-items: start;
            gap: 16px;
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .feature-text h3 {
            font-size: 1.1rem;
            margin-bottom: 6px;
        }

        .feature-text p {
            font-size: 0.95rem;
            opacity: 0.9;
            margin: 0;
        }

        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            padding: 20px;
            overflow-y: auto;
        }

        .auth-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-container {
            background: var(--surface);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            font-size: 1.8rem;
            color: var(--text-main);
            margin-bottom: 8px;
        }

        .auth-header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-group input {
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--surface);
            color: var(--text-main);
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .auth-button {
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .auth-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .auth-button:active:not(:disabled) {
            transform: scale(0.98);
        }

        .auth-divider {
            text-align: center;
            margin: 20px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .auth-switch {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .auth-switch button {
            background: none;
            border: none;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            padding: 0;
            margin-left: 4px;
        }

        .auth-error {
            background: #FFE5E5;
            color: #D32F2F;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 16px;
            display: none;
        }

        [data-theme="dark"] .auth-error {
            background: #4A1F1F;
            color: #FF6B6B;
        }

        .auth-error.active {
            display: block;
        }

        .forgot-password-link {
            text-align: center;
            margin-top: 12px;
        }

        .forgot-password-link button {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Main App Container */
        #app {
            display: none;
            min-height: 100vh;
            padding-bottom: 70px;
        }

        #app.active {
            display: block;
        }

        /* Header */
        .header {
            background: var(--surface);
            padding: 12px 20px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 36px;
            height: 36px;
        }

        .app-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .header-right {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: var(--bg);
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            gap: 8px;
            padding: 16px 20px 12px;
            overflow-x: auto;
            scrollbar-width: none;
            background: var(--bg);
        }

        .filter-tabs::-webkit-scrollbar {
            display: none;
        }

        .filter-tab {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--border);
            background: var(--surface);
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .filter-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Sample Cards */
        .samples-container {
            padding: 12px 20px 20px;
        }

        .sample-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .days-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .days-badge.urgent { background: var(--red); color: white; }
        .days-badge.warning { background: var(--yellow); color: var(--dark); }
        .days-badge.ok { background: var(--green); color: white; }
        .days-badge.done { background: var(--blue); color: white; }

        .delete-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 2px solid var(--red);
            background: transparent;
            color: var(--red);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .delete-btn:active {
            transform: scale(0.95);
            background: var(--red);
            color: white;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 4px;
        }

        .brand-name {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .checklist {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            border: 2px solid var(--border);
            background: var(--surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .checkbox.checked {
            background: var(--green);
            border-color: var(--green);
        }

        .checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .photo-row {
            display: flex;
            gap: 8px;
            margin: 12px 0;
            overflow-x: auto;
        }

        .photo-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            flex-shrink: 0;
        }

        .add-photo-btn {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            border: 2px dashed var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .notes-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .notes-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .action-container {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .row-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .row-btn.primary {
            background: var(--primary);
            color: white;
        }

        .row-btn.secondary {
            background: var(--bg);
            color: var(--text-main);
        }

        .row-btn:active {
            transform: scale(0.98);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            padding: 8px 0;
            z-index: 99;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
            transition: color 0.2s;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.4rem;
        }

        .nav-label {
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(254,44,85,0.4);
            z-index: 98;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .close-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg);
            color: var(--text-main);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-row {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--surface);
            color: var(--text-main);
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        /* Calendar View */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            padding: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            position: relative;
        }

        .calendar-day.has-samples {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .sample-count {
            position: absolute;
            top: 2px;
            right: 2px;
            background: white;
            color: var(--primary);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Settings Page */
        .settings-section {
            padding: 20px;
        }

        .settings-item {
            background: var(--surface);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-label {
            font-size: 1rem;
            color: var(--text-main);
        }

        .toggle-switch {
            width: 50px;
            height: 28px;
            background: var(--border);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: var(--green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 24px;
        }

        .settings-button {
            background: var(--surface);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 1rem;
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-button.danger {
            color: var(--red);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.1rem;
        }

        /* Photo viewer */
        .photo-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .photo-viewer.active {
            display: flex;
        }

        .photo-viewer img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .photo-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Tag Pills */
        .tags-container {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .tag-pill {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            background: var(--bg);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .tag-input-container {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .tag-input {
            flex: 1;
        }

        .add-tag-btn {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 360px) {
            .filter-tab {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .product-name {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage">
        <div class="landing-content">
            <div class="landing-logo">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="20" width="80" height="70" rx="8" fill="#FE2C55"/>
                    <rect x="20" y="30" width="15" height="15" rx="3" fill="white"/>
                    <path d="M 23 37.5 L 27 41.5 L 33 33.5" stroke="#FE2C55" stroke-width="2" fill="none"/>
                    <rect x="40" y="32" width="40" height="4" rx="2" fill="white" opacity="0.7"/>
                    <rect x="40" y="39" width="30" height="3" rx="1.5" fill="white" opacity="0.5"/>
                    <rect x="20" y="52" width="15" height="15" rx="3" fill="white"/>
                    <path d="M 23 59.5 L 27 63.5 L 33 55.5" stroke="#FE2C55" stroke-width="2" fill="none"/>
                    <rect x="40" y="54" width="40" height="4" rx="2" fill="white" opacity="0.7"/>
                    <rect x="40" y="61" width="35" height="3" rx="1.5" fill="white" opacity="0.5"/>
                    <rect x="20" y="74" width="15" height="15" rx="3" fill="white" opacity="0.3"/>
                    <rect x="40" y="76" width="40" height="4" rx="2" fill="white" opacity="0.4"/>
                    <rect x="40" y="83" width="25" height="3" rx="1.5" fill="white" opacity="0.3"/>
                </svg>
            </div>
            
            <h1>Sample Tracker Pro</h1>
            <p>Track your product samples, manage deadlines, and never miss a posting date again.</p>
            
            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-icon">üì¶</div>
                    <div class="feature-text">
                        <h3>Track All Samples</h3>
                        <p>Organize samples with photos, notes, and custom tags</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">‚è∞</div>
                    <div class="feature-text">
                        <h3>Never Miss Deadlines</h3>
                        <p>Smart reminders and visual countdown for posting dates</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">‚úì</div>
                    <div class="feature-text">
                        <h3>Workflow Tracking</h3>
                        <p>Track filming, editing, and posting progress</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">‚òÅÔ∏è</div>
                    <div class="feature-text">
                        <h3>Cloud Sync</h3>
                        <p>Access your samples from anywhere, anytime</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="landing-sticky-bar">
            <button class="primary-button signup" onclick="openSignUp()">Sign Up</button>
            <button class="primary-button signin" onclick="openSignIn()">Sign In</button>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signUpModal" class="auth-modal">
        <div class="auth-container">
            <div class="auth-header">
                <h2>Create Account</h2>
                <p>Start tracking your samples today</p>
            </div>
            
            <div id="signUpError" class="auth-error"></div>
            
            <form class="auth-form" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signUpEmail" required placeholder="you@example.com">
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signUpPassword" required placeholder="At least 6 characters" minlength="6">
                </div>
                
                <button type="submit" class="auth-button" id="signUpBtn">Sign Up</button>
            </form>
            
            <div class="auth-divider">or</div>
            
            <div class="auth-switch">
                Already have an account?
                <button onclick="switchToSignIn()">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div id="signInModal" class="auth-modal">
        <div class="auth-container">
            <div class="auth-header">
                <h2>Welcome Back</h2>
                <p>Sign in to continue tracking</p>
            </div>
            
            <div id="signInError" class="auth-error"></div>
            
            <form class="auth-form" onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signInEmail" required placeholder="you@example.com">
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signInPassword" required placeholder="Enter your password">
                </div>
                
                <button type="submit" class="auth-button" id="signInBtn">Sign In</button>
            </form>
            
            <div class="forgot-password-link">
                <button onclick="openForgotPassword()">Forgot password?</button>
            </div>
            
            <div class="auth-divider">or</div>
            
            <div class="auth-switch">
                Don't have an account?
                <button onclick="switchToSignUp()">Sign Up</button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="auth-modal">
        <div class="auth-container">
            <div class="auth-header">
                <h2>Reset Password</h2>
                <p>We'll send you a reset link</p>
            </div>
            
            <div id="forgotPasswordError" class="auth-error"></div>
            <div id="forgotPasswordSuccess" class="auth-error" style="background: #E8F5E9; color: #2E7D32; display: none;"></div>
            
            <form class="auth-form" onsubmit="handleForgotPassword(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="forgotPasswordEmail" required placeholder="you@example.com">
                </div>
                
                <button type="submit" class="auth-button" id="forgotPasswordBtn">Send Reset Link</button>
            </form>
            
            <div class="auth-divider">or</div>
            
            <div class="auth-switch">
                Remember your password?
                <button onclick="backToSignIn()">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="20" width="80" height="70" rx="8" fill="#FE2C55"/>
                    <rect x="20" y="30" width="15" height="15" rx="3" fill="white"/>
                    <path d="M 23 37.5 L 27 41.5 L 33 33.5" stroke="#FE2C55" stroke-width="2" fill="none"/>
                    <rect x="40" y="32" width="40" height="4" rx="2" fill="white" opacity="0.7"/>
                </svg>
                <span class="app-title">Samples</span>
            </div>
            <div class="header-right">
                <button class="icon-btn" onclick="toggleSearch()">üîç</button>
                <button class="icon-btn" onclick="toggleMenu()">‚ò∞</button>
            </div>
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs" id="filterTabs">
            <button class="filter-tab active" onclick="setFilter('all')">All</button>
            <button class="filter-tab" onclick="setFilter('urgent')">Urgent</button>
            <button class="filter-tab" onclick="setFilter('today')">Today</button>
            <button class="filter-tab" onclick="setFilter('week')">This Week</button>
            <button class="filter-tab" onclick="setFilter('posted')">Posted</button>
        </div>

        <!-- Samples Container -->
        <div class="samples-container" id="samplesContainer">
            <!-- Samples will be rendered here -->
        </div>

        <!-- FAB -->
        <button class="fab" onclick="openAddSample()">+</button>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="switchTab('samples')">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">Samples</div>
            </button>
            <button class="nav-item" onclick="switchTab('calendar')">
                <div class="nav-icon">üìÖ</div>
                <div class="nav-label">Calendar</div>
            </button>
            <button class="nav-item" onclick="switchTab('settings')">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div class="nav-label">Settings</div>
            </button>
        </div>
    </div>

    <!-- Add/Edit Sample Modal -->
    <div id="sampleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add Sample</h3>
                <button class="close-btn" onclick="closeSampleModal()">√ó</button>
            </div>
            
            <div class="form-row">
                <label class="form-label">Brand Name</label>
                <input type="text" class="form-input" id="brandInput" placeholder="e.g., Nike">
            </div>
            
            <div class="form-row">
                <label class="form-label">Product Name</label>
                <input type="text" class="form-input" id="productInput" placeholder="e.g., Air Max 90">
            </div>
            
            <div class="form-row">
                <label class="form-label">Received Date</label>
                <input type="date" class="form-input" id="dateInput">
            </div>
            
            <div class="form-row">
                <label class="form-label">Days to Post</label>
                <input type="number" class="form-input" id="limitInput" placeholder="e.g., 30" min="1">
            </div>
            
            <div class="form-row">
                <label class="form-label">Link (optional)</label>
                <input type="url" class="form-input" id="linkInput" placeholder="https://...">
            </div>
            
            <div class="form-row">
                <label class="form-label">Notes (optional)</label>
                <textarea class="form-textarea" id="notesInput" placeholder="Add any notes..."></textarea>
            </div>
            
            <div class="form-row">
                <label class="form-label">Tags (optional)</label>
                <div class="tag-input-container">
                    <input type="text" class="form-input tag-input" id="tagInput" placeholder="Add tag">
                    <button class="add-tag-btn" onclick="addTag()">Add</button>
                </div>
                <div class="tags-container" id="tagsContainer"></div>
            </div>
            
            <button class="submit-btn" onclick="saveSample()">Save Sample</button>
        </div>
    </div>

    <!-- Menu Modal -->
    <div id="menuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Menu</h3>
                <button class="close-btn" onclick="closeMenu()">√ó</button>
            </div>
            
            <button class="settings-button" onclick="exportCSV(); closeMenu();">
                Export CSV üìä
            </button>
            
            <button class="settings-button" onclick="importData(); closeMenu();">
                Import Data üì•
            </button>
            
            <button class="settings-button" onclick="clearCompleted(); closeMenu();">
                Clear Completed üóëÔ∏è
            </button>
            
            <button class="settings-button" onclick="openPrivacy(); closeMenu();">
                Privacy Policy üîí
            </button>
            
            <button class="settings-button" onclick="openHelp(); closeMenu();">
                Help & Support üí¨
            </button>
            
            <button class="settings-button danger" onclick="handleSignOut()">
                Sign Out üö™
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>
            
            <div class="settings-section">
                <div class="settings-item">
                    <span class="settings-label">Dark Mode</span>
                    <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()"></div>
                </div>
                
                <div class="settings-item">
                    <span class="settings-label">Compact View</span>
                    <div class="toggle-switch" id="compactToggle" onclick="toggleCompactMode()"></div>
                </div>
                
                <div class="settings-item">
                    <span class="settings-label">Notifications</span>
                    <div class="toggle-switch" id="notificationsToggle" onclick="toggleNotifications()"></div>
                </div>
            </div>
            
            <button class="settings-button" onclick="openInstall()">
                Install App üì≤
            </button>
            
            <button class="settings-button" onclick="openSupport()">
                Contact Support üí¨
            </button>
            
            <button class="settings-button danger" onclick="confirmDeleteAccount()">
                Delete Account ‚ö†Ô∏è
            </button>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Privacy Policy</h3>
                <button class="close-btn" onclick="closePrivacy()">√ó</button>
            </div>
            <div style="line-height: 1.6; color: var(--text-secondary);">
                <p style="margin-bottom: 12px;"><strong>Last updated: January 2026</strong></p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Data Collection</h4>
                <p style="margin-bottom: 12px;">We collect only the information you provide: sample details, photos, notes, and account credentials.</p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Data Usage</h4>
                <p style="margin-bottom: 12px;">Your data is used solely to provide and improve the Sample Tracker Pro service. We never sell or share your data with third parties.</p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Data Storage</h4>
                <p style="margin-bottom: 12px;">All data is securely stored using Supabase with encryption at rest and in transit.</p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Your Rights</h4>
                <p style="margin-bottom: 12px;">You can export or delete your data at any time from the settings menu.</p>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Help & Support</h3>
                <button class="close-btn" onclick="closeHelp()">√ó</button>
            </div>
            <div style="line-height: 1.6;">
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Getting Started</h4>
                <p style="margin-bottom: 12px; color: var(--text-secondary);">Tap the + button to add your first sample. Fill in the brand, product name, received date, and posting deadline.</p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Tracking Progress</h4>
                <p style="margin-bottom: 12px; color: var(--text-secondary);">Use the checkboxes to mark filming, editing, and posting status. When you mark "Posted", the sample moves to the Posted tab.</p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Filters</h4>
                <p style="margin-bottom: 12px; color: var(--text-secondary);">Use the tabs at the top to filter samples by urgency or posting status.</p>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Need More Help?</h4>
                <p style="margin-bottom: 12px; color: var(--text-secondary);">Contact us at <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="80f3f5f0f0eff2f4c0f3e1edf0ece5f4f2e1e3ebe5f2aee1f0f0">[email&#160;protected]</a></p>
            </div>
        </div>
    </div>

    <!-- Install Modal -->
    <div id="installModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Install App</h3>
                <button class="close-btn" onclick="closeInstall()">√ó</button>
            </div>
            <div style="line-height: 1.6;">
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">iOS (Safari)</h4>
                <ol style="margin-bottom: 16px; padding-left: 20px; color: var(--text-secondary);">
                    <li style="margin-bottom: 8px;">Tap the Share button (square with arrow)</li>
                    <li style="margin-bottom: 8px;">Scroll down and tap "Add to Home Screen"</li>
                    <li style="margin-bottom: 8px;">Tap "Add" in the top right</li>
                </ol>
                
                <h4 style="margin: 16px 0 8px; color: var(--text-main);">Android (Chrome)</h4>
                <ol style="margin-bottom: 16px; padding-left: 20px; color: var(--text-secondary);">
                    <li style="margin-bottom: 8px;">Tap the menu button (three dots)</li>
                    <li style="margin-bottom: 8px;">Tap "Add to Home screen"</li>
                    <li style="margin-bottom: 8px;">Tap "Add"</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Contact Support</h3>
                <button class="close-btn" onclick="closeSupport()">√ó</button>
            </div>
            <div style="line-height: 1.6; text-align: center; padding: 20px;">
                <p style="margin-bottom: 20px; color: var(--text-secondary); font-size: 1.1rem;">We're here to help!</p>
                <p style="margin-bottom: 12px; color: var(--text-main); font-size: 1.2rem; font-weight: 600;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4e3d3b3e3e213c3a0e3d2f233e222b3a3c2f2d252b3c602f3e3e">[email&#160;protected]</a></p>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">We typically respond within 24 hours</p>
            </div>
        </div>
    </div>

    <!-- Photo Viewer -->
    <div id="photoViewer" class="photo-viewer">
        <button class="photo-viewer-close" onclick="closePhotoViewer()">√ó</button>
        <img id="photoViewerImage" src="" alt="Sample photo">
    </div>

    <script>
        // ==================== GLOBAL BUTTON HANDLERS (defined first) ====================
        function openSignUp() {
            document.getElementById('signUpModal').classList.add('active');
            const errorDiv = document.getElementById('signUpError');
            if (errorDiv) errorDiv.classList.remove('active');
        }

        function openSignIn() {
            document.getElementById('signInModal').classList.add('active');
            const errorDiv = document.getElementById('signInError');
            if (errorDiv) errorDiv.classList.remove('active');
        }

        // Make them available on window too
        window.openSignUp = openSignUp;
        window.openSignIn = openSignIn;

        // ==================== SUPABASE SETUP ====================
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        let supabase;
        
        try {
            if (window.supabase) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            } else {
                console.warn('Supabase library not loaded');
            }
        } catch (error) {
            console.error('Error initializing Supabase:', error);
        }

        // ==================== STATE ====================
        let samples = [];
        let currentFilter = 'all';
        let currentTab = 'samples';
        let editingId = null;
        let currentTags = [];
        let currentUser = null;

        // ==================== AUTHENTICATION ====================
        
        // Check authentication status on load
        async function checkAuth() {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session) {
                    currentUser = session.user;
                    showApp();
                    await loadSamples();
                } else {
                    showLanding();
                }
            } catch (error) {
                console.error('Auth check error:', error);
                showLanding();
            }
        }

        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                showApp();
                loadSamples();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                showLanding();
                samples = [];
            }
        });

        function showApp() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('app').classList.add('active');
        }

        function showLanding() {
            document.getElementById('landingPage').classList.remove('hidden');
            document.getElementById('app').classList.remove('active');
        }

        // Sign Up handlers
        function switchToSignIn() {
            document.getElementById('signUpModal').classList.remove('active');
            openSignIn();
        }

        async function handleSignUp(e) {
            e.preventDefault();
            const email = document.getElementById('signUpEmail').value;
            const password = document.getElementById('signUpPassword').value;
            const btn = document.getElementById('signUpBtn');
            const errorDiv = document.getElementById('signUpError');
            
            btn.disabled = true;
            btn.textContent = 'Creating account...';
            errorDiv.classList.remove('active');
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                });
                
                if (error) throw error;
                
                if (data?.user) {
                    // Check if email confirmation is required
                    if (data.user.identities && data.user.identities.length === 0) {
                        errorDiv.textContent = 'Please check your email to confirm your account.';
                        errorDiv.classList.add('active');
                        errorDiv.style.background = '#E8F5E9';
                        errorDiv.style.color = '#2E7D32';
                    } else {
                        document.getElementById('signUpModal').classList.remove('active');
                    }
                }
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.add('active');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Sign Up';
            }
        }

        // Sign In handlers
        function switchToSignUp() {
            document.getElementById('signInModal').classList.remove('active');
            openSignUp();
        }

        async function handleSignIn(e) {
            e.preventDefault();
            const email = document.getElementById('signInEmail').value;
            const password = document.getElementById('signInPassword').value;
            const btn = document.getElementById('signInBtn');
            const errorDiv = document.getElementById('signInError');
            
            btn.disabled = true;
            btn.textContent = 'Signing in...';
            errorDiv.classList.remove('active');
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password,
                });
                
                if (error) throw error;
                
                document.getElementById('signInModal').classList.remove('active');
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.add('active');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Sign In';
            }
        }

        // Forgot Password
        function openForgotPassword() {
            document.getElementById('signInModal').classList.remove('active');
            document.getElementById('forgotPasswordModal').classList.add('active');
            document.getElementById('forgotPasswordError').classList.remove('active');
            document.getElementById('forgotPasswordSuccess').style.display = 'none';
        }

        function backToSignIn() {
            document.getElementById('forgotPasswordModal').classList.remove('active');
            openSignIn();
        }

        async function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgotPasswordEmail').value;
            const btn = document.getElementById('forgotPasswordBtn');
            const errorDiv = document.getElementById('forgotPasswordError');
            const successDiv = document.getElementById('forgotPasswordSuccess');
            
            btn.disabled = true;
            btn.textContent = 'Sending...';
            errorDiv.classList.remove('active');
            successDiv.style.display = 'none';
            
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin,
                });
                
                if (error) throw error;
                
                successDiv.textContent = 'Password reset email sent! Check your inbox.';
                successDiv.style.display = 'block';
                document.getElementById('forgotPasswordEmail').value = '';
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.add('active');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Send Reset Link';
            }
        }

        // Sign Out
        async function handleSignOut() {
            try {
                await supabase.auth.signOut();
                closeMenu();
            } catch (error) {
                alert('Error signing out: ' + error.message);
            }
        }

        // Delete Account
        async function confirmDeleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone and will delete all your data.')) {
                if (confirm('This is your final warning. Delete account and all data permanently?')) {
                    try {
                        // Delete all user's samples first
                        const { error: deleteError } = await supabase
                            .from('samples')
                            .delete()
                            .eq('user_id', currentUser.id);
                        
                        if (deleteError) throw deleteError;
                        
                        // Note: Actual user account deletion requires admin privileges
                        // For now, we'll sign them out and they can contact support
                        await supabase.auth.signOut();
                        alert('Your data has been deleted. Please contact support@sampletracker.app to complete account deletion.');
                    } catch (error) {
                        alert('Error deleting account: ' + error.message);
                    }
                }
            }
        }

        // ==================== DATABASE OPERATIONS ====================
        
        async function loadSamples() {
            if (!currentUser) return;
            
            try {
                const { data, error } = await supabase
                    .from('samples')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                samples = data || [];
                render();
                renderCalendar();
            } catch (error) {
                console.error('Error loading samples:', error);
            }
        }

        async function saveSamples() {
            // Individual saves are handled in saveSample function
            // This function is kept for compatibility
            return;
        }

        // ==================== SAMPLE MANAGEMENT ====================
        
        function openAddSample() {
            editingId = null;
            currentTags = [];
            document.getElementById('modalTitle').textContent = 'Add Sample';
            document.getElementById('brandInput').value = '';
            document.getElementById('productInput').value = '';
            document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
            document.getElementById('limitInput').value = '30';
            document.getElementById('linkInput').value = '';
            document.getElementById('notesInput').value = '';
            document.getElementById('tagsContainer').innerHTML = '';
            document.getElementById('sampleModal').classList.add('active');
        }

        function editSample(id) {
            const sample = samples.find(s => s.id === id);
            if (!sample) return;
            
            editingId = id;
            currentTags = sample.tags || [];
            document.getElementById('modalTitle').textContent = 'Edit Sample';
            document.getElementById('brandInput').value = sample.brand;
            document.getElementById('productInput').value = sample.product;
            document.getElementById('dateInput').value = sample.date;
            document.getElementById('limitInput').value = sample.limit;
            document.getElementById('linkInput').value = sample.link || '';
            document.getElementById('notesInput').value = sample.notes || '';
            renderTags();
            document.getElementById('sampleModal').classList.add('active');
        }

        async function saveSample() {
            const brand = document.getElementById('brandInput').value.trim();
            const product = document.getElementById('productInput').value.trim();
            const date = document.getElementById('dateInput').value;
            const limit = parseInt(document.getElementById('limitInput').value);
            const link = document.getElementById('linkInput').value.trim();
            const notes = document.getElementById('notesInput').value.trim();
            
            if (!brand || !product || !date || !limit) {
                alert('Please fill in all required fields');
                return;
            }
            
            const sampleData = {
                brand,
                product,
                date,
                limit,
                link: link || null,
                notes: notes || null,
                tags: currentTags,
                user_id: currentUser.id
            };
            
            try {
                if (editingId) {
                    // Update existing sample
                    const { error } = await supabase
                        .from('samples')
                        .update(sampleData)
                        .eq('id', editingId)
                        .eq('user_id', currentUser.id);
                    
                    if (error) throw error;
                } else {
                    // Insert new sample with checklist
                    sampleData.checklist = { filmed: false, edited: false, posted: false };
                    sampleData.done = false;
                    sampleData.photos = [];
                    
                    const { error } = await supabase
                        .from('samples')
                        .insert([sampleData]);
                    
                    if (error) throw error;
                }
                
                await loadSamples();
                closeSampleModal();
            } catch (error) {
                alert('Error saving sample: ' + error.message);
            }
        }

        async function deleteSample(id) {
            if (confirm('Are you sure you want to delete this sample?')) {
                try {
                    const { error } = await supabase
                        .from('samples')
                        .delete()
                        .eq('id', id)
                        .eq('user_id', currentUser.id);
                    
                    if (error) throw error;
                    
                    await loadSamples();
                } catch (error) {
                    alert('Error deleting sample: ' + error.message);
                }
            }
        }

        async function toggleCheck(id, field) {
            const sample = samples.find(s => s.id === id);
            if (!sample) return;
            
            const newChecklist = { ...sample.checklist };
            newChecklist[field] = !newChecklist[field];
            
            // If posted is checked, mark as done and move to posted filter
            const done = newChecklist.posted;
            
            try {
                const { error } = await supabase
                    .from('samples')
                    .update({ 
                        checklist: newChecklist,
                        done: done 
                    })
                    .eq('id', id)
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                await loadSamples();
            } catch (error) {
                console.error('Error updating checklist:', error);
            }
        }

        function closeSampleModal() {
            document.getElementById('sampleModal').classList.remove('active');
            editingId = null;
            currentTags = [];
        }

        // ==================== TAGS ====================
        
        function addTag() {
            const input = document.getElementById('tagInput');
            const tag = input.value.trim();
            if (tag && !currentTags.includes(tag)) {
                currentTags.push(tag);
                input.value = '';
                renderTags();
            }
        }

        function removeTag(tag) {
            currentTags = currentTags.filter(t => t !== tag);
            renderTags();
        }

        function renderTags() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = currentTags.map(tag => 
                `<span class="tag-pill" onclick="removeTag('${tag}')">${tag} √ó</span>`
            ).join('');
        }

        // ==================== PHOTOS ====================
        
        async function addPhoto(id) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = async (ev) => {
                    const sample = samples.find(s => s.id === id);
                    if (!sample) return;
                    
                    const photos = sample.photos || [];
                    photos.push(ev.target.result);
                    
                    try {
                        const { error } = await supabase
                            .from('samples')
                            .update({ photos })
                            .eq('id', id)
                            .eq('user_id', currentUser.id);
                        
                        if (error) throw error;
                        
                        await loadSamples();
                    } catch (error) {
                        console.error('Error adding photo:', error);
                    }
                };
                reader.readAsDataURL(file);
            };
            input.click();
        }

        function viewPhoto(photoUrl) {
            document.getElementById('photoViewerImage').src = photoUrl;
            document.getElementById('photoViewer').classList.add('active');
        }

        function closePhotoViewer() {
            document.getElementById('photoViewer').classList.remove('active');
        }

        // ==================== FILTERING & RENDERING ====================
        
        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            const clickedTab = window.event ? window.event.target : null;
            if (clickedTab) clickedTab.classList.add('active');
            render();
        }

        function getStatusInfo(sample) {
            if (sample.done || sample.checklist.posted) {
                return { text: 'Posted', class: 'done', days: 0 };
            }
            
            const received = new Date(sample.date);
            const dueDate = new Date(received.getTime() + sample.limit * 86400000);
            const today = new Date();
            const daysLeft = Math.ceil((dueDate - today) / 86400000);
            
            if (daysLeft < 0) return { text: `${Math.abs(daysLeft)}d overdue`, class: 'urgent', days: daysLeft };
            if (daysLeft <= 3) return { text: `${daysLeft}d left`, class: 'urgent', days: daysLeft };
            if (daysLeft <= 7) return { text: `${daysLeft}d left`, class: 'warning', days: daysLeft };
            return { text: `${daysLeft}d left`, class: 'ok', days: daysLeft };
        }

        function filterSamples() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            return samples.filter(sample => {
                const info = getStatusInfo(sample);
                
                switch (currentFilter) {
                    case 'urgent':
                        return info.class === 'urgent' && !sample.done;
                    case 'today':
                        const dueDate = new Date(sample.date);
                        dueDate.setDate(dueDate.getDate() + sample.limit);
                        dueDate.setHours(0, 0, 0, 0);
                        return dueDate.getTime() === today.getTime() && !sample.done;
                    case 'week':
                        const weekFromNow = new Date(today.getTime() + 7 * 86400000);
                        const sampleDue = new Date(sample.date);
                        sampleDue.setDate(sampleDue.getDate() + sample.limit);
                        return sampleDue <= weekFromNow && sampleDue >= today && !sample.done;
                    case 'posted':
                        return sample.done || sample.checklist.posted;
                    default:
                        return true;
                }
            });
        }

        function render() {
            const container = document.getElementById('samplesContainer');
            const filtered = filterSamples();
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <div class="empty-state-text">No samples found</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(sample => {
                const info = getStatusInfo(sample);
                const photos = sample.photos || [];
                
                return `
                    <div class="sample-card">
                        <div class="card-header">
                            <div>
                                <div class="days-badge ${info.class}">${info.text}</div>
                                <div class="product-name">${sample.product}</div>
                                <div class="brand-name">${sample.brand}</div>
                            </div>
                            <button class="delete-btn" onclick="deleteSample(${sample.id})">üóë</button>
                        </div>
                        
                        <div class="checklist">
                            <div class="checklist-item">
                                <div class="checkbox ${sample.checklist.filmed ? 'checked' : ''}" 
                                     onclick="toggleCheck(${sample.id}, 'filmed')"></div>
                                <span>Filmed</span>
                            </div>
                            <div class="checklist-item">
                                <div class="checkbox ${sample.checklist.edited ? 'checked' : ''}" 
                                     onclick="toggleCheck(${sample.id}, 'edited')"></div>
                                <span>Edited</span>
                            </div>
                            <div class="checklist-item">
                                <div class="checkbox ${sample.checklist.posted ? 'checked' : ''}" 
                                     onclick="toggleCheck(${sample.id}, 'posted')"></div>
                                <span>Posted</span>
                            </div>
                        </div>
                        
                        ${photos.length > 0 ? `
                            <div class="photo-row">
                                ${photos.map(photo => 
                                    `<img src="${photo}" class="photo-thumbnail" onclick="viewPhoto('${photo}')">`
                                ).join('')}
                                <button class="add-photo-btn" onclick="addPhoto(${sample.id})">+</button>
                            </div>
                        ` : `
                            <div class="photo-row">
                                <button class="add-photo-btn" onclick="addPhoto(${sample.id})">+</button>
                            </div>
                        `}
                        
                        ${sample.notes ? `
                            <div class="notes-section">
                                <div class="notes-text">${sample.notes}</div>
                            </div>
                        ` : ''}
                        
                        ${sample.tags && sample.tags.length > 0 ? `
                            <div class="tags-container">
                                ${sample.tags.map(tag => `<span class="tag-pill">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        <div class="action-container">
                            <button class="row-btn secondary" onclick="editSample(${sample.id})">Edit</button>
                            ${sample.link ? `<button class="row-btn primary" onclick="window.open('${sample.link}', '_blank')">View Link</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCalendar() {
            // Calendar rendering logic would go here
            // This is a placeholder for the calendar view
        }

        // ==================== NAVIGATION ====================
        
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const clickedItem = window.event ? window.event.currentTarget : null;
            if (clickedItem) clickedItem.classList.add('active');
            
            if (tab === 'samples') {
                document.getElementById('samplesContainer').style.display = 'block';
                render();
            } else if (tab === 'calendar') {
                // Switch to calendar view
                alert('Calendar view coming soon!');
            } else if (tab === 'settings') {
                document.getElementById('settingsModal').classList.add('active');
            }
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // ==================== MENU ====================
        
        function toggleMenu() {
            document.getElementById('menuModal').classList.add('active');
        }

        function closeMenu() {
            document.getElementById('menuModal').classList.remove('active');
        }

        function openPrivacy() {
            document.getElementById('privacyModal').classList.add('active');
        }

        function closePrivacy() {
            document.getElementById('privacyModal').classList.remove('active');
        }

        function openHelp() {
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }

        function openInstall() {
            document.getElementById('installModal').classList.add('active');
        }

        function closeInstall() {
            document.getElementById('installModal').classList.remove('active');
        }

        function openSupport() {
            document.getElementById('supportModal').classList.add('active');
        }

        function closeSupport() {
            document.getElementById('supportModal').classList.remove('active');
        }

        // ==================== UTILITIES ====================
        
        function toggleSearch() {
            alert('Search feature coming soon!');
        }

        function exportCSV() {
            const headers = ['Brand', 'Product', 'Received Date', 'Days to Post', 'Due Date', 'Status', 'Link', 'Notes', 'Tags', 'Filmed', 'Edited', 'Posted'];
            const rows = samples.map(s => {
                const dueDate = new Date(new Date(s.date).getTime() + s.limit * 86400000);
                const info = getStatusInfo(s);
                return [
                    s.brand,
                    s.product,
                    s.date,
                    s.limit,
                    dueDate.toISOString().split('T')[0],
                    s.done ? 'Completed' : info.text,
                    s.link || '',
                    s.notes || '',
                    (s.tags || []).join('; '),
                    s.checklist.filmed ? 'Yes' : 'No',
                    s.checklist.edited ? 'Yes' : 'No',
                    s.checklist.posted ? 'Yes' : 'No'
                ].map(v => `"${v}"`).join(',');
            });
            
            const csv = [headers.join(','), ...rows].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `samples_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        async function clearCompleted() {
            if (confirm('Delete all posted samples?')) {
                try {
                    const { error } = await supabase
                        .from('samples')
                        .delete()
                        .eq('user_id', currentUser.id)
                        .eq('done', true);
                    
                    if (error) throw error;
                    
                    await loadSamples();
                } catch (error) {
                    alert('Error clearing completed: ' + error.message);
                }
            }
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (ev) => {
                    try {
                        const imported = JSON.parse(ev.target.result);
                        if (confirm(`Import ${imported.length} samples? This will add to your current data.`)) {
                            // Add user_id to each sample
                            const samplesWithUser = imported.map(s => ({
                                ...s,
                                user_id: currentUser.id
                            }));
                            
                            const { error } = await supabase
                                .from('samples')
                                .insert(samplesWithUser);
                            
                            if (error) throw error;
                            
                            await loadSamples();
                            alert('Data imported successfully!');
                        }
                    } catch (e) {
                        alert('Invalid file format');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ==================== SETTINGS ====================
        
        function toggleDarkMode() {
            const toggle = document.getElementById('darkModeToggle');
            toggle.classList.toggle('active');
            document.documentElement.setAttribute('data-theme', 
                toggle.classList.contains('active') ? 'dark' : 'light');
            localStorage.setItem('darkMode', toggle.classList.contains('active'));
        }

        function toggleCompactMode() {
            const toggle = document.getElementById('compactToggle');
            toggle.classList.toggle('active');
            document.body.classList.toggle('compact-mode');
            localStorage.setItem('compactMode', toggle.classList.contains('active'));
        }

        function toggleNotifications() {
            const toggle = document.getElementById('notificationsToggle');
            toggle.classList.toggle('active');
            localStorage.setItem('notifications', toggle.classList.contains('active'));
            
            if (toggle.classList.contains('active')) {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }
        }

        // ==================== INITIALIZATION ====================
        
        window.addEventListener('load', () => {
            // Load saved preferences
            if (localStorage.getItem('darkMode') === 'true') {
                document.getElementById('darkModeToggle').classList.add('active');
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            if (localStorage.getItem('compactMode') === 'true') {
                document.getElementById('compactToggle').classList.add('active');
